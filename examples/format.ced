formatto âˆ· Î» X : â˜… . X â†’ X â†’ (X â†’ X â†’ X) â†’ X â‡ â˜… â†’ â˜… =
  Î¾ X . X â‡’ X â‡’ (X â‡’ X â‡’ X) â‡’ X â‡ âœ“ â‡’ âœ“ . 

formatti âˆ· âˆ€ X : â˜… . formatto Â· X â‡ â˜… =
  Î¾ X : âœ“ . formatto X â‡ âœ“ . 

iarg âˆ· Î» a . Î» n . Î» p . a â‡ formatti =
  Î¾ X . Ï‡ (Î¾ a . Î² (Î¾ n . Î² (Î¾ p . Î² a))) â‡ Î² â‡ formatti.
inone âˆ· Î» a . Î» n . Î» p . n â‡ formatti = 
  Î¾ X . Ï‡ (Î¾ a . Î² (Î¾ n . Î² (Î¾ p . Î² n))) â‡ Î² â‡ formatti.
iapp âˆ· Î» x . Î» y .Î» a . Î» n . Î» p . p (x a n p) (y a n p) â‡ formatti â†’ formatti â†’ formatti = 
  Î¾ x . Î² (Î¾ y . Î² (Î¾ X . Ï‡ (Î¾ a . Î² (Î¾ n . Î² (Î¾ p . Î² 
      (p ((Ï‡ (x âŒ© X X âŒª) â‡’ Î²) a n p) ((Ï‡ y âŒ© X X âŒª â‡’ Î²) a n p))))) â‡ Î²)) â‡ formatti â‡’ formatti â‡’ formatti.

bool âˆ· âˆ€ X : â˜… . X â†’ X â†’ X â‡ â˜… = Î¾ X : âœ“ . X â‡’ X â‡’ X â‡ âœ“ .

tt âˆ· Î» x . Î» y . x â‡ bool = Î¾ X . Î¾ x . Î² (Î¾ y . Î² x) â‡ bool.
ff âˆ· Î» x . Î» y . y â‡ bool = Î¾ X . Î¾ x . Î² (Î¾ y . Î² y) â‡ bool.

list âˆ· Î» A : â˜… . âˆ€ X : â˜… . (A â†’ X â†’ X) â†’ X â†’ X â‡ â˜… â†’ â˜… =
  Î¾ A . Î¾ X : âœ“ . (A â‡’ X â‡’ X) â‡’ X â‡’ X
  â‡ âœ“ â‡’ âœ“ .

nil âˆ· Î» c . Î» n . n â‡ âˆ€ A : â˜… . list Â· A =
  Î¾ A . Ï‡ (Î¾ X . Î¾ c . Î² (Î¾ n . Î² n)) â‡ Î² 
  â‡ Î¾ A : âœ“ . list A . 
cons âˆ· Î» a . Î» l . Î» c . Î» n . c a (l c n) â‡ âˆ€ A : â˜… . A â†’ list Â· A â†’ list Â· A 
  = Î¾ A . Î¾ a . Î² (Î¾ l . Î² (Ï‡ (Î¾ X . Î¾ c . Î² (Î¾ n. Î² (c a ((Ï‡ l â‡’ Î²) âŒ© X X âŒª c n)))) â‡ Î²)) â‡ Î¾ A : âœ“ . A â‡’ list A â‡’ list A .
append âˆ· Î» x . Î» y . x cons y â‡ âˆ€ A : â˜… . list Â· A â†’ list Â· A â†’ list Â· A =
  Î¾ A . Î¾ x . Î² (Î¾ y . Î² ((Ï‡ x â‡’ Î²) âŒ© (list A) (list Â· A) âŒª (cons âŒ© A A âŒª) y)) â‡ Î¾ A : âœ“ . list A â‡’ list A â‡’ list A .

bitstr âˆ· list Â· bool â‡ â˜… = list bool â‡ âœ“ .

bsingleton âˆ· Î» b . cons b nil â‡ bool â†’ bitstr =
  Î¾ b . Î² (cons âŒ© bool bool âŒª b (nil âŒ© bool bool âŒª)) â‡ bool â‡’ bitstr .

formato âˆ· Î» X : formatti â†’ â˜… .Î» i : formatti . 
            (bool â†’ X inone) â†’ 
            (X iarg) â†’ 
            (âˆ€ a : formatti . âˆ€ b : formatti. X a â†’ X b â†’ X (iapp a b)) â†’ 
            (âˆ€ a : formatti . âˆ€ b : formatti. X a â†’ (X inone â†’ X b) â†’ X (iapp a b)) â†’ 
            (bitstr â†’ X inone) â†’ X i
   â‡ (formatti â†’ â˜…) â†’ formatti â†’ â˜… 
=
  Î¾ X . Î¾ i . 
      (bool â‡’ (X inone)) â‡’ 
      (X iarg) â‡’ 
      (Î¾ a : formatti . Î¾ b : formatti . X a â‡’ X b â‡’ X (iapp a b)) â‡’ 
      (Î¾ a : formatti . Î¾ b : formatti . X a â‡’ (X inone â‡’ X b) â‡’ X (iapp a b)) â‡’
      (bitstr â‡’ X inone) â‡’ X i
  â‡ (formatti â‡’ âœ“) â‡’ formatti â‡’ âœ“ .

formati âˆ· Î» i : formatti . âˆ€ X : formatti â†’ â˜… . formato Â· X i 
             â‡ formatti â†’ â˜… = 
 Î¾ i . Î¾ X : formatti â‡’ âœ“ . formato X i
â‡ formatti â‡’ âœ“ .
 
flit âˆ· Î» x . Î» l . Î» a . Î» p . Î» e . Î» b . l x â‡ bool â†’ formati inone = 
        Î¾ x . Î² (Ï‡ (Î¾ X . Ï‡ (Î¾ l . Î² (Î¾ a . Î² (Î¾ p . Î² (Î¾ e . Î² (Î¾ b . Î² (l x)))))) â‡ Î² âœ“ Â· Î²) â‡ Î²) â‡ bool â‡’ formati inone .
farg âˆ· Î» l . Î» a . Î» p . Î» e . Î» b . a â‡ formati iarg = 
        (Ï‡ (Î¾ X . Ï‡ (Î¾ l . Î² (Î¾ a . Î² (Î¾ p . Î² (Î¾ e . Î² (Î¾ b . Î² a))))) â‡ Î² âœ“ Â· Î²) â‡ Î²) â‡ formati iarg .
fapp âˆ· Î» x . Î» y . Î» l . Î» a . Î» p . Î» e . Î» b . p (x l a p e b) (y l a p e b) 
       â‡ âˆ€ ai : formatti . âˆ€ bi : formatti . formati ai â†’ formati bi â†’ formati (iapp ai bi) = 
  Î¾ ai. Î¾ bi. Î¾ x . Î² (Î¾ y . Î² (Ï‡ (Î¾ X . (Ï‡ (Î¾ l . Î² (Î¾ a . Î² (Î¾ p . Î² (Î¾ e . Î² (Î¾ b . Î² â—one ))))) â‡ Î² âœ“ Â· Î²)) â‡ Î²))
â‡ Î¾ ai : formatti . Î¾ bi : formatti . formati ai â‡’ formati bi â‡’ formati (iapp ai bi) .
flet âˆ· Î» x . Î» y . Î» l . Î» a . Î» p . Î» e . Î» b . e (x l a p e b) (Î» q . y q l a p e b) 
       â‡ âˆ€ ai : formatti . âˆ€ bi : formatti . formati ai â†’ (âˆ€ X : formatti â†’ â˜… . X inone â†’ formato Â· X bi) â†’ formati (iapp ai bi) 
 = 
   Î¾ ai . Î¾ bi . Î¾ x . Î² (Î¾ y . Î² (Ï‡ (Î¾ X . Ï‡ (Î¾ l . Î² (Î¾ a . Î² (Î¾ p . Î² (Î¾ e . Î² (Î¾ b . Î² 
                                      (e { ai ai } {bi bi} 
                                         ((Ï‡ ((Ï‡ x â‡’ Î²) âŒ© X X âŒª) â‡’ Î² âœ“ Â· Î²) l a p e b)
                                         (Î¾ q . (Î² ((Ï‡ (y âŒ© X X âŒª q ) â‡’ Î² âœ“ Â· Î²) l a p e b))))))))) â‡ Î² âœ“ Â· Î²)
                                   â‡ Î²))
 â‡ Î¾ ai : formatti . Î¾ bi : formatti . formati ai â‡’ (Î¾ X : formatti â‡’ âœ“ . X inone â‡’ formato X bi) â‡’ formati (iapp ai bi) .
fbitstr âˆ· Î» x . Î» l . Î» a . Î» p . Î» e . Î» b . b x â‡ bitstr â†’ formati inone = â— â‡ â— .
var âˆ· Î» x . Î» l . Î» a . Î» p . Î» e . Î» b . x â‡ âˆ€ X : â˜… . X â†’ formato Â· X inone = â— â‡ â— .

Fa âˆ· Î» r : â˜… . (bool â†’ r) â‡ â˜… â†’ â˜… = Î¾ r . bool â‡’ r â‡ âœ“ â‡’ âœ“ .
Fn âˆ· Î» r : â˜… . r â‡ â˜… â†’ â˜… = Î¾ r . r â‡ âœ“ â‡’ âœ“ .
Fp âˆ· Î» f : â˜… â†’ â˜… . Î» g : â˜… â†’ â˜… . Î» r : â˜… . f Â· (g Â· r) â‡ (â˜… â†’ â˜…) â†’ (â˜… â†’ â˜…) â†’ (â˜… â†’ â˜…) = 
  Î¾ f . Î¾ g . Î¾ r . f (g r) â‡ Î´ ğ’Œ âˆ· â˜… â†’ â˜… â‡ â–¡ = âœ“ â‡’ âœ“ - ğ’Œ â‡’ ğ’Œ â‡’ ğ’Œ.

format-th âˆ· 
  Î» i : formatti . â†‘ i : ((â˜† â†’ â˜†) â†’ (â˜† â†’ â˜†) â†’ ((â˜† â†’ â˜†) â†’ (â˜† â†’ â˜†) â†’ (â˜† â†’ â˜†)) â†’ (â˜† â†’ â˜†)) Â· Fa Â· Fn Â· Fp
      â‡ formatti â†’ â˜… â†’ â˜… = 
Î¾ i . (â†‘ X . (Ï‡ (i âŒ© (X â‡’ X) (X â†’ X) âŒª) â‡’ Î²) : ((X â‡’ X) â‡’ (X â‡’ X) â‡’ ((X â‡’ X) â‡’ (X â‡’ X) â‡’ (X â‡’ X)) â‡’ (X â‡’ X))) Fa Fn Fp
â‡ formatti â‡’ âœ“ â‡’ âœ“ .

formathr âˆ· Î» i : formatti . âˆ€ A : â˜… . (bitstr â†’ A) â†’ format-th i Â· A â‡ formatti â†’ â˜… 
  = Î¾ i . Î¾ A : âœ“ . (bitstr â‡’ A) â‡’ (format-th i A) â‡ formatti â‡’ âœ“  . 

formath âˆ·
  Î» a . a (Î» b . Î» f . f (bsingleton b))
          (Î» f . Î» b . f (bsingleton b))
          (Î» r . Î» r' . Î» f . r (Î» s . r' (Î» s' . f (append s s'))))
          (Î» r . Î» r' . Î» f . r (Î» s . r' (Î» f . f s) f))
          (Î» s . Î» f . f s)
â‡ âˆ€ i : formatti . formati i â†’ formathr i =
Î¾ i . Î¾ a . Î² 
 ((Ï‡ ((Ï‡ a â‡’ Î²) âŒ© formathr formathr âŒª) â‡’ Î² âœ“ Â· Î²)
   (Î¾ b . Î² (Ï‡ (Î¾ A . Î¾ f . Î² (Ï‡ (f (bsingleton b)) â‡ (Î² âœ“ Â· Î² âœ“ âœ“ âœ“ âœ“ Â· Î² âœ“ âœ“ âœ“ Â· Î² âœ“ âœ“ Â· Î² âœ“ Â· Î²))) â‡ Î²))
   (Ï‡ (Î¾ A . Î¾ f . Î² (Ï‡ (Î¾ b . Î² (f (bsingleton b))) â‡ (Î² âœ“ Â· Î² âœ“ âœ“ âœ“ âœ“ Â· Î² âœ“ âœ“ âœ“ Â· Î² âœ“ âœ“ Â· Î² âœ“ Â· Î²))) â‡ Î²)
   (Î¾ a . Î¾ b . Î¾ r . Î² (Î¾ r' . Î² (Ï‡ (Î¾ A . Î¾ f . Î² 
      (Ï‡ (Ï‡ ((Ï‡ r â‡’ Î²) âŒ© (format-th b A) (format-th b Â· A) âŒª (Î¾ s . Î² ((Ï‡ r' â‡’ Î²) âŒ© A A âŒª (Î¾ s' . Î² (f (append âŒ© bool bool âŒª s s'))))))
            â‡’ Î² âœ“ Â· (âœ“ (Î² âœ“)))
       â‡ Î² âœ“ Â· Î² âœ“ âœ“ âœ“ âœ“ Â· Î² âœ“ âœ“ âœ“ Â· Î² âœ“ âœ“ Â· Î² âœ“ Â· Î² âœ“ âœ“ Â· Î² âœ“ Â· Î² Â· Î·â†‘ 3 âœ“ âœ“ âœ“ âœ“ Â· âœ“ (Î·â†‘ 3 âœ“ âœ“ âœ“ âœ“)))
      â‡ ((âœ“ (Î² âœ“) Â· âœ“ Î²) Â· Î²))))
   (Î¾ a . Î¾ b . Î¾ r . Î² (Î¾ r' . Î² (Ï‡ (Î¾ A . Î¾ f . Î² 
       (Ï‡ (Ï‡ ((Ï‡ r â‡’ Î²) âŒ© (format-th b A) (format-th b Â· A) âŒª 
               (Î¾ s . Î² 
                  ((Ï‡ r' â‡’ (Î² â‡’ Î²)) 
                   (Î¾ A . Î¾ f . Î² (Ï‡ (f s) â‡ Î² âœ“ Â· Î² âœ“ âœ“ âœ“ âœ“ Â· Î² âœ“ âœ“ âœ“ Â· Î² âœ“ âœ“ Â· Î² âœ“ Â· Î²))
                 âŒ© A A âŒª f)
                )) â‡’ Î² âœ“ Â· (âœ“ (Î² âœ“))) 
      â‡ Î² âœ“ Â· Î² âœ“ âœ“ âœ“ âœ“ Â· Î² âœ“ âœ“ âœ“ Â· Î² âœ“ âœ“ Â· Î² âœ“ Â· Î² âœ“ âœ“ Â· Î² âœ“ Â· Î² Â· Î·â†‘ 3 âœ“ âœ“ âœ“ âœ“ Â· âœ“ (Î·â†‘ 3 âœ“ âœ“ âœ“ âœ“)))
     â‡ (âœ“ (Î² âœ“) Â· âœ“ Î² Â· Î²))))
   (Î¾ s . Î² (Ï‡ (Î¾ A . Î¾ f . Î² (Ï‡ (f s) â‡ (Î² âœ“ Â· Î² âœ“ âœ“ âœ“ âœ“ Â· Î² âœ“ âœ“ âœ“ Â· Î² âœ“ âœ“ Â· Î² âœ“ Â· Î²))) â‡ Î²)))
â‡ Î¾ i : formatti . formati i â‡’ formathr i .

testic âˆ· iapp iarg (iapp inone (iapp inone inone)) â‡ formatti = iapp iarg (iapp inone (iapp inone inone)) â‡ formatti.

testfc âˆ· flet farg (Î» i . fapp (var i) (fapp (flit tt) (var i))) â‡ formati testic = 
 (flet { iarg iarg } { (iapp inone (iapp inone inone)) (iapp inone (iapp inone inone))} farg 
   (Î¾ X . Î¾ i . Î² â—)) â‡ formati testic .

normalize formath testfc (Î» x . x).